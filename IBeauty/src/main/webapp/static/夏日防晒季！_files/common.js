"use strict";var SFM=window.SFM=window.SFM||{};SFM.CONFIG=SFM.CONFIG||{};var webp=window.webp=window.webp||{};webp.common=function(){},webp.common.prototype={init:function(){this.BanNotActionFormSubmit(),this.BanDisabledDefault(),this.LazyLoad(),this.CustomTab(),this.showScroll(),this.goback(),this.searchBar(),this.singlePageSlide(),this.popbox(),this.inputFocus(),this.appBanner(),this.newUser(),this.opacity()},ua:function(e){var t=navigator.userAgent;return e?e.test(t):t},clicktype:function(){return this.ua(/Mobile/g)?"touchstart":"click"},BanNotActionFormSubmit:function(){$("form").on("submit",function(e){$(this).attr("action")||e.preventDefault()})},BanDisabledDefault:function(){$(".disabled").on("click",function(){return!1})},LazyLoad:function(){$.fn.lazyload&&$("img.lazy").lazyload({placeholder:"http://assets.vmei.com/images/pic-blank.png",effect:"fadeIn",threshold:100,failure_limit:6})},CustomTab:function(){$(".tab-titles").on("customTab","li",function(){if(0!=$(this).has("a").length)var e=$("a",this).attr("href");else var e="#";if(0==e.indexOf("#")&&e.length>1){var t=$(e);0==$(this).index()?($(this).addClass("selected"),t.addClass("tab_c selected")):$(this).hasClass("selected")?($(this).siblings().removeClass("selected"),t.addClass("tab_c selected"),$(this).parent().nextAll("div:eq(0)").removeClass("selected").hide()):t.addClass("tab_c").hide(),$(this).click(function(){return $(this).addClass("selected").siblings().removeClass("selected"),t.addClass("selected").show().siblings(".tab_c").removeClass("selected").hide(),!1})}else if(0==e.indexOf("#")&&1==e.length){if(0!=$(this).parentsUntil(".tab-titles").length)var t=$(this).parentsUntil(".tab-titles").last().parent().nextAll("div:eq("+$(this).index()+")");else var t=$(this).parent().nextAll("div:eq("+$(this).index()+")");0==$(this).index()?($(this).addClass("selected"),t.addClass("tab_c selected")):$(this).hasClass("selected")?($(this).siblings().removeClass("selected"),t.addClass("tab_c selected"),$(this).parent().nextAll("div:eq(0)").removeClass("selected").hide()):t.addClass("tab_c").hide(),$(this).click(function(){return $(this).addClass("selected").siblings().removeClass("selected"),t.addClass("selected").show().siblings(".tab_c").removeClass("selected").hide(),!1})}}),"undefined"!=typeof name?$(""+name+" li").trigger("customTab"):$(".tab-titles li").trigger("customTab")},switchContent:function(){function e(e){if("undefined"!=e){var t=$("#top").outerHeight(),n=$(e).offset().top;$(window).scrollTop()+t!==n&&$("body").animate({scrollTop:n-t},200)}}var t=this;$(".switch").on("click",function(n){var o=$(this).attr("href"),i=$(this).attr("data-targetClass1"),a=$(this).attr("data-targetClass2");if(0!=i.length&&0!=a.length){var s=$(o);0===o.indexOf("#")&&o.length>1&&(s.hasClass(i)?(s.addClass(a).removeClass(i),$(this).addClass("state1").removeClass("state2")):(s.addClass(i).removeClass(a),$(this).addClass("state2").removeClass("state1")),t.setImgWH(),e(this))}n.preventDefault()}),$("body").on("click","#sort-box a",function(e){$(".filter .screening").trigger("click"),e.preventDefault()})},showScroll:function(){$(window).scroll(function(){$(window).scrollTop()>1600?($(".gotop").animate({right:"0"},200),$(".mainreturn").animate({left:"0"},200)):($(".gotop").animate({right:"-60px"},300),$(".mainreturn").animate({left:"-60px"},300))}),$(".goTopbd").click(function(e){$("body").animate({scrollTop:"0px"},300),e.preventDefault()})},goback:function(){$(".goback, .icon-back, .icon.back, .link-back").click(function(e){var t=$(this).attr("href");if(!t||"#"==t){if(e.preventDefault(),!document.referrer)return void(window.location.href="/");""!=window.location.hash?window.location.href=document.referrer:window.history.back()}})},scrollfixed:function(e){$(window).load(function(){var t=e||".scroll_fixed",n=$(t);if(0===n.length)return!1;var o=n.offset().top;$(window).scroll(function(){var e=$(window).scrollTop(),t=e>o?"0":"";o>e?n.removeClass("fixed top").addClass("static"):(n.removeClass("static").addClass("fixed top"),t?(n.css("top",t),n.removeClass("static").addClass("fixed")):n.removeClass("static").addClass("fixed top"))})})},setImgWH:function(){var e=function(){$(".product-list .pic img").each(function(){var e=$(this).parent().width();$(this).css({width:e,height:e})})};e(),$(window).resize(function(){e()})},searchBar:function(e){var t=e||".searchBar",n=$(t),o=$('input[type="search"]',n),i=$(".icon-clear,.icon.clear",n);o.keyup(function(){""!=o.val()?i.show():i.hide()}),i.click(function(e){o.val(""),i.hide(),e.preventDefault()})},contentsIndex:function(e){var t=e||".contents-index a";$(t).click(function(e){var t=$(this).attr("href"),n=$(this).parent(),o=n.offset().top,i=n.next();if($(t).length<=0)return!1;var a=$(t).offset().top,s=(i.css("top"),a-o);$(i).animate({scrollTop:$(i).scrollTop()+s},300),e.preventDefault()})},singlePageSlide:function(e){function t(){setTimeout(function(){$(document.body).animate({scrollTop:"0"},300)},300)}var n=this;$(".goNext").click(function(){n.goNext()}),$(".goPrev").click(function(){n.goPrev(),t()})},goNext:function(){var e=name||".pages",t=parseInt($(e).css("left")),n=$("#main").outerWidth();$(e).css("left",t-n+"px")},goPrev:function(){var e=name||".pages",t=parseInt($(e).css("left")),n=$("#main").outerWidth();$(e).css("left",t+n+"px")},priceAmount:function(e,t){var n=e||".amount_tool";$(n).each(function(){function e(){-1!=s.length&&(l=n.find('[name="unit-price"]'),s.text((Number(l.val())*Number(a.val())).toFixed(2))),t&&t(a.val(),n)}var n=$(this),o=n.find(".increase"),i=n.find(".decrease"),a=n.find(".sum"),s=n.find(".total"),c=Boolean(a.attr("data-isLiveShow")),r=c?99:""!=a.attr("max")?parseInt(a.attr("max")):99,l=n.find('[name="unit-price"]');o.click(function(){return a.val()<r&&a.val(Number(a.val())+1),e(),!1}),i.click(function(){return a.val()>1&&(a.val(Number(a.val())-1),e()),!1});var d=Number(a.val())||1;a.focus(function(){d=$(this).val()}).blur(function(){Number(a.val())>Number(r)?a.val(d):e()})})},scrollLoadMore:function(e){var t,n=$(window).height(),o=$(document).height(),i=$("#footer"),a=!1;$(window).scroll(function(){t=$(document).scrollTop(),-1!=i.length&&(o=i.offset().top),n+t>=o&&0==a&&(a=!0,e())})},popbox:function(e){var t=e||".popbox";$(".popbox .head").each(function(){0==$(".popbox .head .close").length&&$(".popbox .head").append('<a class="close" href="#">关闭</a>')}),$(".openpop,.popbox").on("popbox",function(){$(".openpop").click(function(e){var t=$(this).attr("href");0==t.indexOf("#")&&t.length>1&&$(t).show();var n=$(t).outerHeight();$(t).css("margin-top",-(n/2)),e.preventDefault()}),$("> .head",t).click(function(){$(this).parent().hide()}),$(".close",t).click(function(e){$(this).parentsUntil(".popbox").last().parent().hide(),e.preventDefault()}),$(".cancel",t).click(function(){$(this).parentsUntil(t)?$(this).parentsUntil(t).last().parent().hide():$(this).parent().parent().hide()})}),$(".openpop,.popbox").trigger("popbox")},loadingBox:function(e,t){var n=t||"";if("remove"==e)$(".loadingBox").fadeOut(800),setTimeout(function(){$(".loadingBox").remove()},800);else{var o=e||"Loading...";$("body").append('<div class="loadingBox '+n+'"><p>'+o+"</p></div>")}},removeLoadingBoxAsync:function(e){setTimeout(function(){$(".loadingBox").remove(),e()},2e3)},tip:function(e,t,n){if(!e)return!1;var o=t||"";$(".softlyTipBox").remove(),$("body").append('<div class="softlyTipBox '+o+'"><p>'+e+"</p></div>"),setTimeout(function(){$("body > .softlyTipBox").addClass("show")},10),setTimeout(function(){$("body > .softlyTipBox").css({width:0,"margin-left":0}),setTimeout(function(){$("body > .softlyTipBox").remove()},300),n&&n()},3e3)},msgBox:function(e,t,n){if(!e)return!1;var o=t||SFM.CONFIG._TXT_TIP_TITLE||"消息",i=n||"";$("body").append('<div class="popbox '+i+'" style="display: block;"><div class="head">'+o+'<a class="close" href="#">'+(SFM.CONFIG._TXT_CLOSE||"关闭")+'</a></div><div class="main">'+e+"</div></div>"),$(".popbox .close, .popbox .cancel").on("click",function(e){e.preventDefault(),$(this).parentsUntil(".popbox").last().parent().remove()})},confirmBox:function(e,t,n,o){if(!e)return!1;var i=t||SFM.CONFIG._TXT_TIP_TITLE||"消息";"function"==typeof t&&(i=SFM.CONFIG._TXT_TIP_TITLE||"消息");var a=$('<div class="popbox poptip" style="display: block;"><div class="head">'+i+'<a class="close" href="#">'+(SFM.CONFIG._TXT_CLOSE||"关闭")+'</a></div><div class="main">'+e+'</div><div class="foot"><a class="btn confirm" href="#">'+(SFM.CONFIG._TXT_CONFIRM||"确认")+'</a> <a class="btn cancel" href="#">'+(SFM.CONFIG._TXT_CANCEL||"取消")+"</a></div></div>");o&&a.find(".foot").html(o),$("body").append(a),$(".close, .cancel",a).click(function(e){e.preventDefault(),$(this).parentsUntil(".popbox").last().parent().remove()}),$(".confirm",a).click(function(e){$(this).parentsUntil(".popbox").last().parent().remove(),"function"==typeof t?t():n(),e.preventDefault()})},inputFocus:function(){$("input, textarea").focus(function(){$("#nav").hide()}).blur(function(){$("#nav").show()})},setExchangePrice:function(e,t){var n=Number(t),o=e||".product";n&&$(o).each(function(){if(0!=$(".mod_currencyUnit",this).length){$(".mod_currencyUnit",this).show();var e="";e=Number(0==$("del.price",this).length?$("strong.price",this).text():$("del.price",this).text()),$(".mod_currencyUnit .price",this).text(Math.ceil(e/n).toFixed(2))}})},weixin:function(e){function t(t){wx.config({debug:n,appId:t.appId,timestamp:t.timestamp,nonceStr:t.noncestr,signature:t.signature,jsApiList:o}),wx.ready(function(){"function"==typeof e&&e(t.appId)}),n&&alert("appId: "+t.appId+"\ntimestamp: "+t.timestamp+"\nnonceStr: "+t.noncestr+"\nsignature: "+t.signature)}if("undefined"!=typeof wx&&""!=wx){var n=!1,o=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","launch3rdApp","openCard"],i="/openapi/jssdk/getConfig";return"undefined"!=typeof systemDomain&&(i=systemDomain+i),SFM.wxConfigAppId&&SFM.wxConfigURL&&SFM.wxConfigURL==window.location.href?e(SFM.wxConfigAppId):void $.ajax({url:i,type:"POST",data:{currUrl:window.location.href},dataType:"json",success:function(e){SFM.wxConfigURL=window.location.href,SFM.wxConfigAppId=e.appId,t(e)},error:function(){return n&&alert("fail to get config url"),console.log("can not get config url")},fail:function(){return n&&alert("can not support weixin sdk"),console.log("can not support weixin sdk")}})}},weixinLocation:function(e){this.weixin(function(){wx.getLocation({success:function(t){"function"==typeof e&&e(t)},cancel:function(){alert("用户拒绝授权获取地理位置")}})})},weixinLaunch3rdApp:function(){this.weixin(function(e){wx.invoke("launch3rdApp",{appID:e||"wx750d04a3aefa4059",messageExt:encodeURI(a.iosUrl||a.url),extInfo:encodeURI(a.androidUrl||a.url)},function(){})})},weixinShare:function(e){function t(e,t){var n=e.indexOf("?");if(-1!=n){var o=new RegExp("(^|&)"+t+"([^&]*)(?=&|$)","g"),i=e.substr(n+1),a=i.replace(o,"");a=0==a.indexOf("&")?a.substr(1):a,a=0==a.length?"":"?"+a,e=e.substr(0,n)+a}return e}function n(e,t){var n={sti:m.sti||0,do_act:e||"",share_to:t||"",type:m.type||"activityWeb",type_val:m.type_val||"",uskey:d,share_path:s};try{SFM.Stats().upload(20,n)}catch(o){console.log(o)}}function o(e){return{title:l,desc:r,link:s,imgUrl:c,success:function(){p(),n("succ",e)},cancel:function(){h(),n("cancel",e)},fail:function(){n("fail",e)}}}function i(e){return{title:r,link:s,imgUrl:c,success:function(){p(),n("succ",e)},cancel:function(){h(),n("cancel",e)},fail:function(){n("fail",e)}}}function a(){wx.onMenuShareAppMessage(o("wfriend")),wx.onMenuShareTimeline(i("wecosys")),wx.onMenuShareQQ(o("qq")),wx.onMenuShareWeibo(o("sina"))}if("undefined"!=typeof wx&&""!=wx){if(e){var s=e.lineLink||window.location.href,c=e.imgUrl||"",r=e.descContent||"",l=e.shareTitle||"思芙美妆，海淘全球美妆",d=(e.productId||"0",e.uskey||"0"),u=(e.config||"",e.params||""),f=e.customUrl||"",p=e.success||function(){},h=e.cancel||function(){},m=e.reportData||{},v=(e.debug||!1,"");window.location.hash&&(v=window.location.hash,s=s.replace(v,""));var g="",w=["197ceebdfb944481b334595d1f96e6aa","12f57af0c2ec45ecac0de2a2b732ba1e","16f6c0f76c6b411cb9cacd759327db36","2837e42bbeeb41a4b17810a7e7e70164","7c26f0c3a1c24190ab37bc0671cbc958","43a7dfb2312d475a99f4440d441e0054","4f0ee2b750c640cd9f99fbc752bc86ce","1d8bda1d58984e1d9b79269c5c530da7"];"0"==d||-1!=$.inArray(d,w)?(g="(code=|actId=|fromUserId=|orderUserId=)",s=t(s,g)):(g="(uskey=|userkey=|userKey=|code=|actId=|fromUserId=|orderUserId=)",s=t(s,g),s+=-1==s.indexOf("?")?"?uskey="+d:"&uskey="+d),u&&(s+=-1==s.indexOf("?")?"?"+u:"&"+u),f&&(s=f),""!=v&&(s+=v),this.weixin(function(){a()})}}},vmios:function(e){window.WebViewJavascriptBridge?e(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){e(WebViewJavascriptBridge)},!1)},datePlug:function(){$(".startTime").date({theme:"datetime"}),$(".endTime").date({theme:"datetime"})},popTouch:function(e,t){if(e){var n,o,i=e.offset().top,a=e.outerHeight(),s=$(window).height(),c=!1,r=!0;e.on("touchstart",function(t){n=t.originalEvent.touches[0].clientY,c=s-e.offset().top>=a?!1:!0,r=e.offset().top>=i?!1:!0,t.stopPropagation()}),e.on("touchmove",function(e){o=e.originalEvent.touches[0].clientY,n>o&&(c||(t&&t(),e.preventDefault())),o>n&&(r||(t&&t(),e.preventDefault())),e.stopPropagation()})}},ajaxData:function(e){var t,n,o,i,a,s,c,r,l,d,u=this;"object"==typeof e&&(t=e.url||"",n=e.type||"GET",o=e.data||{},i=e.timeout||"",a=e.target||"",s=e.beforeSend||function(){},c=e.complete||function(){},r=e.success||function(){},l=e.error||function(){},d=e.fail||function(){});var f=$.ajax({url:t,type:n,data:o,beforeSend:function(){s()},complete:function(){c()},success:function(e){e.success?r(e):u.tip(e.msg)},error:function(){l()},fail:function(){d()}});return f},minfor:function(e,t){for(var n=0;e>n;n++)t(n)},appBanner:function(){function e(e){e.parent().slideUp().addClass("closed"),e.parent().prev(".open_appbanner").addClass("active")}function t(){var e=$(".bottom-toolbar"),t=$("#nav");0==e.length&&0==t.length&&$(".mod_appbanner, .mod_toapp").css("bottom",0)}0!=$(".mod_appbanner, .mod_toapp").length&&($(".mod_appbanner, .mod_toapp").removeAttr("style"),$(".mod_appbanner, .mod_toapp").on("click",".close",function(t){t.preventDefault(),t.stopPropagation();var n=$(this);e(n),n.parent().parent().slideUp().addClass("closed")}),$(".open_appbanner").on("click",function(){$(this).removeClass("active"),$(this).next(".main").slideDown()}),$(".mod_appbanner, .mod_toapp").on("click",".open_appbanner",function(){$(this).removeClass("active"),$(this).next(".main").slideUp()}),t())},newUser:function(){-1==window.location.href.indexOf("http://m.vmei.com/login")&&$.cookie&&"function"==typeof $.cookie&&"hide"!=$.cookie("newUserState")&&$.ajax({url:"/wechatUserBindingCoupon/checkBinding",type:"GET",success:function(e){return e.data.isBinding?!1:void $.ajax({url:"/wechatUserBindingCoupon/tmpl/newUser",type:"GET",dataType:"html",success:function(e){$(document.body).append(e)}})}}),$("body").on("click",".newUserClose",function(){$(this).parents(".popbox").hide(),$.cookie&&"function"==typeof $.cookie&&$.cookie("newUserState","hide",{expires:.05})})},datetime:function(){{var e=Math.floor(countT/86400),t=Math.floor(countT/3600)-24*e,n=Math.floor(countT/60)-24*e*60-60*t;Math.floor(countT)-24*e*60*60-60*t*60-60*n}},openapi:function(){function e(){$(".isad, .mod_appbanner, .mod_toapp, .bottom-qrcode, #header").hide()}return $.cookie&&$.cookie("third_party")?void e():void 0},moveRefresh:function(){var e,t,n,o=($(window),function(o){if(o.touches.length){var i=o.touches[0];e=window.scrollY,t=i.pageX,n=i.pageY}}),i=function(o){if(o.touches.length){var i=o.touches[0],a=(i.pageX-t,i.pageY-n);0>=e&&a>60&&window.location.reload()}};window.addEventListener("touchstart",o,!1),window.addEventListener("touchmove",i,!1),this.removeRefresh(o,i)},removeRefresh:function(e,t){window.removeEventListener("touchstart",e,!1),window.removeEventListener("touchmove",t,!1)},opacity:function(){$(window).on("scroll",function(e){var t=e.currentTarget.scrollY<=300?e.currentTarget.scrollY/300:1;t=1-t,t>=.7&&(t=.7);var n=$(".mod_toapp .main");n.css("background-color","rgba(58,53,85,"+t+")")})}},$.fn.extend({countDown:function(e,t,n){function o(e){return 10>e?"0"+e:e}function i(e){var t=e||"",i=window.setInterval(function(){var e=(new Date).getTime(),s=Math.floor((p-e)/1e3),c=Math.floor(s/86400),r=Math.floor(s/3600)-24*c,v=Math.floor(s/60)-24*c*60-60*r,$=Math.floor(s)-24*c*60*60-60*r*60-60*v;if(f>h);else{if(!(h>=f&&p>=h))return n&&n(a),void clearInterval(i);if(!(s>0))return a.text(l),n&&n(a),void clearInterval(i);d?(0==m&&s--,0>m&&(m=9)):s--;var g=u;t.html(g[0]+'<span class="ui-num">'+o(c)+"</span>"+g[1]+'<span class="ui-num">'+o(r)+"</span>"+g[2]+'<span class="ui-num">'+o(v)+"</span>"+g[3]+'<span class="ui-num">'+o($)+"</span>"+(d?"."+m:"")+g[4]),d&&m--,n&&n(t)}},d?100:1e3)}var a=this;if(e){var s=e.startTime||"",c=e.endTime||"",r=e.openText||"于"+s.replace("00:00:00","")+"开团",l=e.offText||"已结束",d=e.showMsec||!1,u=(e.formatTxt||["","天","时","分","秒"],e.formatStart||["距开团：","天","时","分","秒"],e.formatEnd||["","天","时","分","秒"]),f=new Date(s).getTime(),p=new Date(c).getTime(),h=(new Date).getTime(),m=(Math.floor((p-h)/1e3),9);if(f>p)return void $(a).remove();if(h>p||f>p)return void a.text(l);if(f>h)return $(a).prevAll(".num_buy").remove(),$(a).show(),0!=r.indexOf("00:00:00")?r=r.replace("00:00:00","0点"):0!=r.indexOf(":00:00")&&(r=r.replace(":00:00","点")),void a.text(r);$(a).show(),i($(a))}}}),$.fn.extend({scrollLoadData:function(e,t){function n(){o.attr("data-loading","false"),o.next(".loadMore").css("visibility","hidden")}var o=this,i={"data-hasnext":"","data-loading":"false"},a=$.extend(i,e,{});if("object"==typeof e)for(var s in a)o.attr(s,a[s]);0==o.next(".loadMore").length&&o.after('<div class="loadMore loading" style="visibility: hidden;">Loading...</div>');var c=$(window).height();$(window).resize(function(){c=$(window).height()}),$(document).scroll(function(){if("true"!=o.attr("data-loading")&&"true"==o.attr("data-builded")){if("false"==o.attr("data-hasnext"))return void o.next(".loadMore").remove();var e=$(this).height(),i=$(this).scrollTop();i+c>=e&&(o.attr("data-loading","true"),o.next(".loadMore").css("visibility","visible"),t&&t(n))}})},sortDate:function(){if(SFM.DateUtils){var e="undefined"!=typeof $(this).text()?$(this).text().replace(/-/g,"/"):"",t=new Date(e).getTime();if(t){var n=SFM.DateUtils();$(this).text(n.getIntervalTime(t))}}}}),SFM.getQueryString=function(e,t){var n=new RegExp("(^|\\?|&)"+e+"=([^&]*)(&|$)","i"),t=t||window.location.search,o=t.match(n);return null!=o?unescape(o[2]):null},$(".showRemark").on("click",function(){$(this).parent().find(".remark").slideToggle()});var commonStart=new webp.common;$(function(){commonStart.init(),commonStart.moveRefresh()});